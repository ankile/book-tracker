import{d as Me,f as j,s as u,a as z,e as Te,c as Ze,t as et}from"../chunks/B3brjmWg.js";import{p as Pe,s as L,g as Ye,b as $e,h as D,f as Be,i as a,j as r,k as t,A as S,m as s,n as E,t as O,a as Ae}from"../chunks/COs9BhvN.js";import{D as Fe,e as de,i as ne,f as Ce,N as tt}from"../chunks/CQtZaaab.js";import{i as ce,a as st,s as at}from"../chunks/4Dd6Wes_.js";import{s as De,u as ot,a as lt}from"../chunks/BDqwyajx.js";import{g as rt}from"../chunks/C5FAtmQX.js";var it=j('<span class="month-label svelte-1ofjo4"> </span>'),vt=j('<div class="day-cell svelte-1ofjo4"></div>'),dt=j('<div class="week-column svelte-1ofjo4"></div>'),nt=j("<div> </div>"),ct=j('<div class="heatmap-container svelte-1ofjo4"><div class="heatmap-header svelte-1ofjo4"><h2 class="svelte-1ofjo4">Reading Activity</h2> <div class="heatmap-stats svelte-1ofjo4"><div class="stat svelte-1ofjo4"><span class="stat-value svelte-1ofjo4"> </span> <span>days active</span></div> <div class="stat svelte-1ofjo4"><span class="stat-value svelte-1ofjo4"> </span> <span>day streak</span></div> <div class="stat svelte-1ofjo4"><span class="stat-value svelte-1ofjo4"> </span> <span>longest streak</span></div></div></div> <div class="heatmap-wrapper svelte-1ofjo4"><div class="month-labels svelte-1ofjo4" style="position: relative; height: 15px;"></div> <div class="heatmap-grid svelte-1ofjo4"><div class="day-labels svelte-1ofjo4"><div class="day-label svelte-1ofjo4">Mon</div> <div class="day-label svelte-1ofjo4"></div> <div class="day-label svelte-1ofjo4">Wed</div> <div class="day-label svelte-1ofjo4"></div> <div class="day-label svelte-1ofjo4">Fri</div> <div class="day-label svelte-1ofjo4"></div> <div class="day-label svelte-1ofjo4"></div></div> <div class="heatmap svelte-1ofjo4"></div></div></div> <div class="legend svelte-1ofjo4"><span>Less</span> <div class="legend-colors svelte-1ofjo4"><div class="legend-cell svelte-1ofjo4" style="background-color: #ebedf0"></div> <div class="legend-cell svelte-1ofjo4" style="background-color: #9be9a8"></div> <div class="legend-cell svelte-1ofjo4" style="background-color: #40c463"></div> <div class="legend-cell svelte-1ofjo4" style="background-color: #30a14e"></div> <div class="legend-cell svelte-1ofjo4" style="background-color: #216e39"></div></div> <span>More</span></div></div> <!>',1);function ut(ue,w){Pe(w,!0);let b=L(!1),ee=L(""),te=L(0),Y=L(0),X=L(Ye([]));$e(()=>{if(!w.userId||!w.allBooks||w.allBooks.length===0){D(X,[],!0);return}const e=[],l=new Map;return w.allBooks.forEach(o=>{const d=Fe.getReadingSessions(w.userId,o.id).subscribe(n=>{l.set(o.id,n),D(X,Array.from(l.values()).flat(),!0)});e.push(d)}),()=>{e.forEach(o=>o())}});let V=E(()=>{const e=new Map;return s(X).forEach(l=>{const o=l.createdAt?.toDate?.();if(!o)return;const i=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`;e.has(i)||e.set(i,{date:new Date(o.getFullYear(),o.getMonth(),o.getDate()),pagesRead:0,timeRead:0,sessions:0});const d=e.get(i);d.pagesRead+=l.pagesRead||0,d.timeRead+=l.timeRead||0,d.sessions+=1}),e}),H=E(()=>{const e=new Date,l=new Date(e.getFullYear(),e.getMonth(),e.getDate()),o=new Date(l);o.setDate(o.getDate()-364);const i=l.getDay(),d=i===0?0:7-i;l.setDate(l.getDate()+d);const n=o.getDay();o.setDate(o.getDate()-n),o.setDate(o.getDate()+1);const f=[];let k=new Date(o);for(;k<=l;){const m=[];for(let $=0;$<7;$++){const A=`${k.getFullYear()}-${String(k.getMonth()+1).padStart(2,"0")}-${String(k.getDate()).padStart(2,"0")}`,F=s(V).get(A);m.push({date:new Date(k),dayKey:A,pagesRead:F?.pagesRead||0,timeRead:F?.timeRead||0,sessions:F?.sessions||0}),k.setDate(k.getDate()+1)}f.push(m)}return f});function x(e){return e===0?"#ebedf0":e<10?"#9be9a8":e<25?"#40c463":e<50?"#30a14e":"#216e39"}function B(e){const l=e.date.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"});return e.pagesRead===0?`${l}
No reading activity`:`${l}
${e.pagesRead} pages
${Ce(e.timeRead)}
${e.sessions} session${e.sessions!==1?"s":""}`}function se(e,l){D(ee,B(l),!0),ae(e),D(b,!0)}function ae(e){D(te,e.clientX,!0),D(Y,e.clientY,!0)}function oe(){D(b,!1)}let ge=E(()=>{const e=[];let l=-1;return s(H).forEach((o,i)=>{const d=o[0],n=d.date.getMonth();if(n!==l){let f=0;for(let k=i;k<s(H).length&&s(H)[k][0].date.getMonth()===n;k++)f++;f>=2&&(e.length===0||i-e[e.length-1].weekIndex>=2)&&e.push({weekIndex:i,month:d.date.toLocaleDateString("en-US",{month:"short"})}),l=n}}),e}),q=E(()=>{let e=0,l=0,o=0,i=0,d=0;s(V).forEach(m=>{e+=m.pagesRead,l+=m.timeRead,m.pagesRead>0&&o++});const n=new Date;n.setHours(0,0,0,0);let f=new Date(n),k=!0;for(let m=0;m<365;m++){const $=`${f.getFullYear()}-${String(f.getMonth()+1).padStart(2,"0")}-${String(f.getDate()).padStart(2,"0")}`,A=s(V).get($);A&&A.pagesRead>0?(d++,d>i&&(i=d)):(k&&(f.getTime()===n.getTime()||(k=!1)),k||(d=0)),f.setDate(f.getDate()-1)}return{totalPages:e,totalTime:l,activeDays:o,currentStreak:k?d:0,longestStreak:i}});var p=ct(),c=Be(p),v=a(c),h=r(a(v),2),g=a(h),T=a(g),G=a(T,!0);t(T),S(2),t(g);var _=r(g,2),y=a(_),M=a(y,!0);t(y),S(2),t(_);var R=r(_,2),N=a(R),J=a(N,!0);t(N),S(2),t(R),t(h),t(v);var W=r(v,2),K=a(W);de(K,21,()=>s(ge),ne,(e,l)=>{var o=it(),i=a(o,!0);t(o),O(()=>{De(o,`left: ${(s(l).weekIndex+1)*14}px;`),u(i,s(l).month)}),z(e,o)}),t(K);var le=r(K,2),U=r(a(le),2);de(U,21,()=>s(H),ne,(e,l)=>{var o=dt();de(o,21,()=>s(l),ne,(i,d)=>{var n=vt();n.__mousemove=ae,O(f=>De(n,`background-color: ${f??""}`),[()=>x(s(d).pagesRead)]),Te("mouseenter",n,f=>se(f,s(d))),Te("mouseleave",n,oe),z(i,n)}),t(o),z(e,o)}),t(U),t(le),t(W),S(2),t(c);var re=r(c,2);{var fe=e=>{var l=nt(),o=a(l,!0);t(l),O(()=>{De(l,`position: fixed; left: ${s(te)??""}px; top: ${s(Y)??""}px; background: rgba(0, 0, 0, 0.9); color: white; padding: 0.5rem 0.75rem; border-radius: 4px; font-size: 0.75rem; white-space: pre-line; pointer-events: none; z-index: 9999; transform: translate(10px, 10px); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);`),u(o,s(ee))}),z(e,l)};ce(re,e=>{s(b)&&e(fe)})}O(()=>{u(G,s(q).activeDays),u(M,s(q).currentStreak),u(J,s(q).longestStreak)}),z(ue,p),Ae()}Me(["mousemove"]);var gt=j('<span class="book-info svelte-1ke34sz"><span class="book-title svelte-1ke34sz"> </span> <span class="book-pages svelte-1ke34sz"> </span></span>'),ft=j('<tr class="svelte-1ke34sz"><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"><!></td></tr>'),kt=j('<div class="books-by-year svelte-1ke34sz"><h2 class="svelte-1ke34sz">Books by Year</h2> <table class="svelte-1ke34sz"><thead><tr class="svelte-1ke34sz"><th class="svelte-1ke34sz">Year</th><th class="svelte-1ke34sz">Books</th><th class="svelte-1ke34sz">Hours</th><th class="svelte-1ke34sz">Pages</th><th class="svelte-1ke34sz">Longest Book</th></tr></thead><tbody></tbody></table></div>'),pt=j('<!> <div class="profile-container svelte-1ke34sz"><div class="profile-header svelte-1ke34sz"><h1 class="svelte-1ke34sz"> </h1> <p class="email svelte-1ke34sz"> </p></div> <div class="actions svelte-1ke34sz"><button class="svelte-1ke34sz">Add New Book</button> <button class="svelte-1ke34sz">Sign Out</button></div> <div class="stats-grid svelte-1ke34sz"><a href="/finished" class="stat-card clickable svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Books Read</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">Completed books</div></a> <a href="/" class="stat-card clickable svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Currently Reading</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">In progress</div></a> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Total Time Read</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz"> </div></div> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Books Per Year</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">Average rate</div></div> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Avg. Time Per Book</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">For finished books</div></div> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Total Books</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">In your library</div></div></div> <!> <!></div>',1);function xt(ue,w){Pe(w,!0);const b=()=>st(ot,"$user",ee),[ee,te]=at();let Y=L(!1);async function X(){await lt(),rt("/",{replaceState:!0})}const V=()=>D(Y,!s(Y)),H=()=>D(Y,!1);let x=L(Ye([]));$e(()=>{if(b())return Fe.getAllBooks(b().uid).subscribe(c=>{D(x,c,!0)})});const B=E(()=>()=>{const p=s(x).filter(_=>_.finished),c=s(x).filter(_=>!_.finished),v=s(x).reduce((_,y)=>_+(y.timeRead||0),0),h=s(x).reduce((_,y)=>_+(y.pagesRead||0),0);let g=0;if(p.length>0){const y=p.map(R=>R.createdAt?.toDate?.()||new Date).sort((R,N)=>R-N)[0],M=(new Date-y)/(1e3*60*60*24*365);g=M>0?(p.length/M).toFixed(1):0}const T=p.length>0?Math.round(p.reduce((_,y)=>_+(y.timeRead||0),0)/p.length):0,G=Math.round(v/60);return{totalBooks:s(x).length,finishedBooks:p.length,readingBooks:c.length,totalTimeRead:v,totalTimeReadHours:G,totalPagesRead:h,booksPerYear:g,avgTimePerBook:T}}),se=E(()=>()=>{const p=s(x).filter(v=>v.finished),c={};return p.forEach(v=>{const h=v.createdAt?.toDate?.();if(h){const g=h.getFullYear();c[g]||(c[g]={count:0,totalTimeRead:0,totalPages:0,longestBook:null}),c[g].count+=1,c[g].totalTimeRead+=v.timeRead||0,c[g].totalPages+=v.pagesRead||0,(!c[g].longestBook||v.pageCount>c[g].longestBook.pageCount)&&(c[g].longestBook=v)}}),Object.entries(c).sort(([v],[h])=>h-v).map(([v,h])=>({year:v,count:h.count,totalTimeRead:h.totalTimeRead,totalPages:h.totalPages,longestBook:h.longestBook}))}),ae=E(()=>b()?b().email.split("@")[0]:"");var oe=Ze(),ge=Be(oe);{var q=p=>{var c=pt(),v=Be(c);tt(v,{get open(){return s(Y)},onclose:H,get userId(){return b().uid}});var h=r(v,2),g=a(h),T=a(g),G=a(T);t(T);var _=r(T,2),y=a(_,!0);t(_),t(g);var M=r(g,2),R=a(M);R.__click=V;var N=r(R,2);N.__click=X,t(M);var J=r(M,2),W=a(J),K=r(a(W),2),le=a(K,!0);t(K),S(2),t(W);var U=r(W,2),re=r(a(U),2),fe=a(re,!0);t(re),S(2),t(U);var e=r(U,2),l=r(a(e),2),o=a(l);t(l);var i=r(l,2),d=a(i);t(i),t(e);var n=r(e,2),f=r(a(n),2),k=a(f,!0);t(f),S(2),t(n);var m=r(n,2),$=r(a(m),2),A=a($,!0);t($),S(2),t(m);var F=r(m,2),Re=r(a(F),2),Ie=a(Re,!0);t(Re),S(2),t(F),t(J);var Se=r(J,2);{var Le=Q=>{var Z=kt(),ie=r(a(Z),2),ve=r(a(ie));de(ve,21,()=>s(se)(),ne,(ke,C)=>{let pe=()=>s(C).year,Oe=()=>s(C).count,He=()=>s(C).totalTimeRead,Ne=()=>s(C).totalPages,he=()=>s(C).longestBook;var _e=ft(),me=a(_e),We=a(me,!0);t(me);var be=r(me),Ke=a(be,!0);t(be);var ye=r(be),Ue=a(ye,!0);t(ye);var ze=r(ye),Xe=a(ze,!0);t(ze);var je=r(ze),Ve=a(je);{var qe=P=>{var I=gt(),xe=a(I),Je=a(xe,!0);t(xe);var we=r(xe,2),Qe=a(we);t(we),t(I),O(()=>{u(Je,he().title),u(Qe,`(${he().pageCount??""} pages)`)}),z(P,I)},Ge=P=>{var I=et("-");z(P,I)};ce(Ve,P=>{he()?P(qe):P(Ge,!1)})}t(je),t(_e),O((P,I)=>{u(We,pe()),u(Ke,Oe()),u(Ue,P),u(Xe,I)},[()=>Math.round(He()/60),()=>Ne().toLocaleString()]),z(ke,_e)}),t(ve),t(ie),t(Z),z(Q,Z)};ce(Se,Q=>{s(se)().length>0&&Q(Le)})}var Ee=r(Se,2);ut(Ee,{get userId(){return b().uid},get allBooks(){return s(x)}}),t(h),O((Q,Z,ie,ve,ke,C,pe)=>{u(G,`Welcome back, ${s(ae)??""}!`),u(y,b().email),u(le,Q),u(fe,Z),u(o,`${ie??""} hrs`),u(d,`${ve??""} pages read`),u(k,ke),u(A,C),u(Ie,pe)},[()=>s(B)().finishedBooks,()=>s(B)().readingBooks,()=>s(B)().totalTimeReadHours,()=>s(B)().totalPagesRead.toLocaleString(),()=>s(B)().booksPerYear,()=>Ce(s(B)().avgTimePerBook),()=>s(B)().totalBooks]),z(p,c)};ce(ge,p=>{b()&&p(q)})}z(ue,oe),Ae(),te()}Me(["click"]);export{xt as component};

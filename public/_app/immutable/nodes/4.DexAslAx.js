import{d as Me,f as S,s as u,a as z,e as we,c as Ze,t as et}from"../chunks/B3brjmWg.js";import{p as Pe,s as E,g as Ye,b as $e,h as B,f as xe,i as a,j as r,k as t,A as j,m as s,n as I,t as O,a as Ae}from"../chunks/COs9BhvN.js";import{D as Fe,e as de,i as ne,f as Ce,N as tt}from"../chunks/CQtZaaab.js";import{i as ce,a as st,s as at}from"../chunks/4Dd6Wes_.js";import{s as Be,u as ot,a as lt}from"../chunks/BDqwyajx.js";import{g as rt}from"../chunks/QCGVMuVj.js";var vt=S('<span class="month-label svelte-1ofjo4"> </span>'),it=S('<div class="day-cell svelte-1ofjo4"></div>'),dt=S('<div class="week-column svelte-1ofjo4"></div>'),nt=S('<div class="tooltip svelte-1ofjo4"> </div>'),ct=S('<div class="heatmap-container svelte-1ofjo4"><div class="heatmap-header svelte-1ofjo4"><h2 class="svelte-1ofjo4">Reading Activity</h2> <div class="heatmap-stats svelte-1ofjo4"><div class="stat svelte-1ofjo4"><span class="stat-value svelte-1ofjo4"> </span> <span>days active</span></div> <div class="stat svelte-1ofjo4"><span class="stat-value svelte-1ofjo4"> </span> <span>day streak</span></div> <div class="stat svelte-1ofjo4"><span class="stat-value svelte-1ofjo4"> </span> <span>longest streak</span></div></div></div> <div class="heatmap-wrapper svelte-1ofjo4"><div class="month-labels svelte-1ofjo4" style="position: relative; height: 15px;"></div> <div class="heatmap-grid svelte-1ofjo4"><div class="day-labels svelte-1ofjo4"><div class="day-label svelte-1ofjo4">Mon</div> <div class="day-label svelte-1ofjo4"></div> <div class="day-label svelte-1ofjo4">Wed</div> <div class="day-label svelte-1ofjo4"></div> <div class="day-label svelte-1ofjo4">Fri</div> <div class="day-label svelte-1ofjo4"></div> <div class="day-label svelte-1ofjo4"></div></div> <div class="heatmap svelte-1ofjo4"></div></div></div> <div class="legend svelte-1ofjo4"><span>Less</span> <div class="legend-colors svelte-1ofjo4"><div class="legend-cell svelte-1ofjo4" style="background-color: #ebedf0"></div> <div class="legend-cell svelte-1ofjo4" style="background-color: #9be9a8"></div> <div class="legend-cell svelte-1ofjo4" style="background-color: #40c463"></div> <div class="legend-cell svelte-1ofjo4" style="background-color: #30a14e"></div> <div class="legend-cell svelte-1ofjo4" style="background-color: #216e39"></div></div> <span>More</span></div></div> <!>',1);function ut(ue,T){Pe(T,!0);let b=E(!1),ee=E(""),te=E(0),Y=E(0),U=E(Ye([]));$e(()=>{if(!T.userId||!T.allBooks||T.allBooks.length===0){B(U,[],!0);return}const e=[],l=new Map;return T.allBooks.forEach(o=>{const d=Fe.getReadingSessions(T.userId,o.id).subscribe(c=>{l.set(o.id,c),B(U,Array.from(l.values()).flat(),!0)});e.push(d)}),()=>{e.forEach(o=>o())}});let X=I(()=>{const e=new Map;return s(U).forEach(l=>{const o=l.createdAt?.toDate?.();if(!o)return;const v=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`;e.has(v)||e.set(v,{date:new Date(o.getFullYear(),o.getMonth(),o.getDate()),pagesRead:0,timeRead:0,sessions:0});const d=e.get(v);d.pagesRead+=l.pagesRead||0,d.timeRead+=l.timeRead||0,d.sessions+=1}),e}),V=I(()=>{const e=new Date,l=new Date(e.getFullYear(),e.getMonth(),e.getDate()),o=new Date(l);o.setDate(o.getDate()-364);const v=l.getDay(),d=v===0?0:7-v;l.setDate(l.getDate()+d);const c=o.getDay();o.setDate(o.getDate()-c),o.setDate(o.getDate()+1);const h=[];let _=new Date(o);for(;_<=l;){const m=[];for(let $=0;$<7;$++){const A=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}-${String(_.getDate()).padStart(2,"0")}`,F=s(X).get(A);m.push({date:new Date(_),dayKey:A,pagesRead:F?.pagesRead||0,timeRead:F?.timeRead||0,sessions:F?.sessions||0}),_.setDate(_.getDate()+1)}h.push(m)}return h});function D(e){return e===0?"#ebedf0":e<10?"#9be9a8":e<25?"#40c463":e<50?"#30a14e":"#216e39"}function x(e){const l=e.date.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"});return e.pagesRead===0?`${l}
No reading activity`:`${l}
${e.pagesRead} pages
${Ce(e.timeRead)}
${e.sessions} session${e.sessions!==1?"s":""}`}function se(e,l){B(ee,x(l),!0),ae(e),B(b,!0)}function ae(e){B(te,e.clientX,!0),B(Y,e.clientY,!0)}function oe(){B(b,!1)}let ge=I(()=>{const e=[];let l=-1;return s(V).forEach((o,v)=>{const d=o[0],c=d.date.getMonth();c!==l&&(v<s(V).length-2&&(e.length===0||v-e[e.length-1].weekIndex>=2)&&e.push({weekIndex:v,month:d.date.toLocaleDateString("en-US",{month:"short"})}),l=c)}),e}),q=I(()=>{let e=0,l=0,o=0,v=0,d=0;s(X).forEach(m=>{e+=m.pagesRead,l+=m.timeRead,m.pagesRead>0&&o++});const c=new Date;c.setHours(0,0,0,0);let h=new Date(c),_=!0;for(let m=0;m<365;m++){const $=`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}-${String(h.getDate()).padStart(2,"0")}`,A=s(X).get($);A&&A.pagesRead>0?(d++,d>v&&(v=d)):(_&&(h.getTime()===c.getTime()||(_=!1)),_||(d=0)),h.setDate(h.getDate()-1)}return{totalPages:e,totalTime:l,activeDays:o,currentStreak:_?d:0,longestStreak:v}});var f=ct(),n=xe(f),i=a(n),k=r(a(i),2),g=a(k),w=a(g),G=a(w,!0);t(w),j(2),t(g);var p=r(g,2),y=a(p),M=a(y,!0);t(y),j(2),t(p);var R=r(p,2),H=a(R),J=a(H,!0);t(H),j(2),t(R),t(k),t(i);var N=r(i,2),W=a(N);de(W,21,()=>s(ge),ne,(e,l)=>{var o=vt(),v=a(o,!0);t(o),O(()=>{Be(o,`left: ${s(l).weekIndex*14}px;`),u(v,s(l).month)}),z(e,o)}),t(W);var le=r(W,2),K=r(a(le),2);de(K,21,()=>s(V),ne,(e,l)=>{var o=dt();de(o,21,()=>s(l),ne,(v,d)=>{var c=it();c.__mousemove=ae,O(h=>Be(c,`background-color: ${h??""}`),[()=>D(s(d).pagesRead)]),we("mouseenter",c,h=>se(h,s(d))),we("mouseleave",c,oe),z(v,c)}),t(o),z(e,o)}),t(K),t(le),t(N),j(2),t(n);var re=r(n,2);{var fe=e=>{var l=nt(),o=a(l,!0);t(l),O(()=>{Be(l,`left: ${s(te)??""}px; top: ${s(Y)??""}px;`),u(o,s(ee))}),z(e,l)};ce(re,e=>{s(b)&&e(fe)})}O(()=>{u(G,s(q).activeDays),u(M,s(q).currentStreak),u(J,s(q).longestStreak)}),z(ue,f),Ae()}Me(["mousemove"]);var gt=S('<span class="book-info svelte-1ke34sz"><span class="book-title svelte-1ke34sz"> </span> <span class="book-pages svelte-1ke34sz"> </span></span>'),ft=S('<tr class="svelte-1ke34sz"><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"><!></td></tr>'),kt=S('<div class="books-by-year svelte-1ke34sz"><h2 class="svelte-1ke34sz">Books by Year</h2> <table class="svelte-1ke34sz"><thead><tr class="svelte-1ke34sz"><th class="svelte-1ke34sz">Year</th><th class="svelte-1ke34sz">Books</th><th class="svelte-1ke34sz">Hours</th><th class="svelte-1ke34sz">Pages</th><th class="svelte-1ke34sz">Longest Book</th></tr></thead><tbody></tbody></table></div>'),pt=S('<!> <div class="profile-container svelte-1ke34sz"><div class="profile-header svelte-1ke34sz"><h1 class="svelte-1ke34sz"> </h1> <p class="email svelte-1ke34sz"> </p></div> <div class="actions svelte-1ke34sz"><button class="svelte-1ke34sz">Add New Book</button> <button class="svelte-1ke34sz">Sign Out</button></div> <div class="stats-grid svelte-1ke34sz"><a href="/finished" class="stat-card clickable svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Books Read</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">Completed books</div></a> <a href="/" class="stat-card clickable svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Currently Reading</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">In progress</div></a> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Total Time Read</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz"> </div></div> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Books Per Year</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">Average rate</div></div> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Avg. Time Per Book</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">For finished books</div></div> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Total Books</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">In your library</div></div></div> <!> <!></div>',1);function Dt(ue,T){Pe(T,!0);const b=()=>st(ot,"$user",ee),[ee,te]=at();let Y=E(!1);async function U(){await lt(),rt("/",{replaceState:!0})}const X=()=>B(Y,!s(Y)),V=()=>B(Y,!1);let D=E(Ye([]));$e(()=>{if(b())return Fe.getAllBooks(b().uid).subscribe(n=>{B(D,n,!0)})});const x=I(()=>()=>{const f=s(D).filter(p=>p.finished),n=s(D).filter(p=>!p.finished),i=s(D).reduce((p,y)=>p+(y.timeRead||0),0),k=s(D).reduce((p,y)=>p+(y.pagesRead||0),0);let g=0;if(f.length>0){const y=f.map(R=>R.createdAt?.toDate?.()||new Date).sort((R,H)=>R-H)[0],M=(new Date-y)/(1e3*60*60*24*365);g=M>0?(f.length/M).toFixed(1):0}const w=f.length>0?Math.round(f.reduce((p,y)=>p+(y.timeRead||0),0)/f.length):0,G=Math.round(i/60);return{totalBooks:s(D).length,finishedBooks:f.length,readingBooks:n.length,totalTimeRead:i,totalTimeReadHours:G,totalPagesRead:k,booksPerYear:g,avgTimePerBook:w}}),se=I(()=>()=>{const f=s(D).filter(i=>i.finished),n={};return f.forEach(i=>{const k=i.createdAt?.toDate?.();if(k){const g=k.getFullYear();n[g]||(n[g]={count:0,totalTimeRead:0,totalPages:0,longestBook:null}),n[g].count+=1,n[g].totalTimeRead+=i.timeRead||0,n[g].totalPages+=i.pagesRead||0,(!n[g].longestBook||i.pageCount>n[g].longestBook.pageCount)&&(n[g].longestBook=i)}}),Object.entries(n).sort(([i],[k])=>k-i).map(([i,k])=>({year:i,count:k.count,totalTimeRead:k.totalTimeRead,totalPages:k.totalPages,longestBook:k.longestBook}))}),ae=I(()=>b()?b().email.split("@")[0]:"");var oe=Ze(),ge=xe(oe);{var q=f=>{var n=pt(),i=xe(n);tt(i,{get open(){return s(Y)},onclose:V,get userId(){return b().uid}});var k=r(i,2),g=a(k),w=a(g),G=a(w);t(w);var p=r(w,2),y=a(p,!0);t(p),t(g);var M=r(g,2),R=a(M);R.__click=X;var H=r(R,2);H.__click=U,t(M);var J=r(M,2),N=a(J),W=r(a(N),2),le=a(W,!0);t(W),j(2),t(N);var K=r(N,2),re=r(a(K),2),fe=a(re,!0);t(re),j(2),t(K);var e=r(K,2),l=r(a(e),2),o=a(l);t(l);var v=r(l,2),d=a(v);t(v),t(e);var c=r(e,2),h=r(a(c),2),_=a(h,!0);t(h),j(2),t(c);var m=r(c,2),$=r(a(m),2),A=a($,!0);t($),j(2),t(m);var F=r(m,2),Re=r(a(F),2),Le=a(Re,!0);t(Re),j(2),t(F),t(J);var je=r(J,2);{var Ee=Q=>{var Z=kt(),ve=r(a(Z),2),ie=r(a(ve));de(ie,21,()=>s(se)(),ne,(ke,C)=>{let pe=()=>s(C).year,Oe=()=>s(C).count,He=()=>s(C).totalTimeRead,Ne=()=>s(C).totalPages,he=()=>s(C).longestBook;var _e=ft(),me=a(_e),We=a(me,!0);t(me);var be=r(me),Ke=a(be,!0);t(be);var ye=r(be),Ue=a(ye,!0);t(ye);var ze=r(ye),Xe=a(ze,!0);t(ze);var Se=r(ze),Ve=a(Se);{var qe=P=>{var L=gt(),De=a(L),Je=a(De,!0);t(De);var Te=r(De,2),Qe=a(Te);t(Te),t(L),O(()=>{u(Je,he().title),u(Qe,`(${he().pageCount??""} pages)`)}),z(P,L)},Ge=P=>{var L=et("-");z(P,L)};ce(Ve,P=>{he()?P(qe):P(Ge,!1)})}t(Se),t(_e),O((P,L)=>{u(We,pe()),u(Ke,Oe()),u(Ue,P),u(Xe,L)},[()=>Math.round(He()/60),()=>Ne().toLocaleString()]),z(ke,_e)}),t(ie),t(ve),t(Z),z(Q,Z)};ce(je,Q=>{s(se)().length>0&&Q(Ee)})}var Ie=r(je,2);ut(Ie,{get userId(){return b().uid},get allBooks(){return s(D)}}),t(k),O((Q,Z,ve,ie,ke,C,pe)=>{u(G,`Welcome back, ${s(ae)??""}!`),u(y,b().email),u(le,Q),u(fe,Z),u(o,`${ve??""} hrs`),u(d,`${ie??""} pages read`),u(_,ke),u(A,C),u(Le,pe)},[()=>s(x)().finishedBooks,()=>s(x)().readingBooks,()=>s(x)().totalTimeReadHours,()=>s(x)().totalPagesRead.toLocaleString(),()=>s(x)().booksPerYear,()=>Ce(s(x)().avgTimePerBook),()=>s(x)().totalBooks]),z(f,n)};ce(ge,f=>{b()&&f(q)})}z(ue,oe),Ae(),te()}Me(["click"]);export{Dt as component};

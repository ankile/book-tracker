import{d as Me,f as T,s as c,a as z,e as Te,c as Ze,t as et}from"../chunks/B3brjmWg.js";import{p as Pe,s as O,g as Ye,b as $e,h as B,i as s,j as r,k as t,A as S,m as a,n as H,t as N,a as Ae,f as we}from"../chunks/COs9BhvN.js";import{D as Fe,e as de,i as ne,f as Ce,N as tt}from"../chunks/CQtZaaab.js";import{i as ce,a as st,s as at}from"../chunks/4Dd6Wes_.js";import{s as De,u as ot,a as lt}from"../chunks/BDqwyajx.js";import{g as rt}from"../chunks/C7WHEsZm.js";var vt=T('<span class="month-label svelte-1ofjo4"> </span>'),it=T('<div class="day-cell svelte-1ofjo4"></div>'),dt=T('<div class="week-column svelte-1ofjo4"></div>'),nt=T('<div class="tooltip svelte-1ofjo4"> </div>'),ct=T('<div class="heatmap-container svelte-1ofjo4"><div class="heatmap-header svelte-1ofjo4"><h2 class="svelte-1ofjo4">Reading Activity</h2> <div class="heatmap-stats svelte-1ofjo4"><div class="stat svelte-1ofjo4"><span class="stat-value svelte-1ofjo4"> </span> <span>days active</span></div> <div class="stat svelte-1ofjo4"><span class="stat-value svelte-1ofjo4"> </span> <span>day streak</span></div> <div class="stat svelte-1ofjo4"><span class="stat-value svelte-1ofjo4"> </span> <span>longest streak</span></div></div></div> <div class="heatmap-wrapper svelte-1ofjo4"><div class="month-labels svelte-1ofjo4" style="position: relative; height: 15px;"></div> <div class="heatmap-grid svelte-1ofjo4"><div class="day-labels svelte-1ofjo4"><div class="day-label svelte-1ofjo4">Mon</div> <div class="day-label svelte-1ofjo4"></div> <div class="day-label svelte-1ofjo4">Wed</div> <div class="day-label svelte-1ofjo4"></div> <div class="day-label svelte-1ofjo4">Fri</div> <div class="day-label svelte-1ofjo4"></div> <div class="day-label svelte-1ofjo4"></div></div> <div class="heatmap svelte-1ofjo4"></div></div></div> <!> <div class="legend svelte-1ofjo4"><span>Less</span> <div class="legend-colors svelte-1ofjo4"><div class="legend-cell svelte-1ofjo4" style="background-color: #ebedf0"></div> <div class="legend-cell svelte-1ofjo4" style="background-color: #9be9a8"></div> <div class="legend-cell svelte-1ofjo4" style="background-color: #40c463"></div> <div class="legend-cell svelte-1ofjo4" style="background-color: #30a14e"></div> <div class="legend-cell svelte-1ofjo4" style="background-color: #216e39"></div></div> <span>More</span></div></div>');function ut(ue,w){Pe(w,!0);let m=O(!1),Z=O(""),ee=O(0),$=O(0),K=O(Ye([]));$e(()=>{if(!w.userId||!w.allBooks||w.allBooks.length===0){B(K,[],!0);return}const e=[],l=new Map;return w.allBooks.forEach(o=>{const v=Fe.getReadingSessions(w.userId,o.id).subscribe(u=>{l.set(o.id,u),B(K,Array.from(l.values()).flat(),!0)});e.push(v)}),()=>{e.forEach(o=>o())}});let U=H(()=>{const e=new Map;return a(K).forEach(l=>{const o=l.createdAt?.toDate?.();if(!o)return;const i=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`;e.has(i)||e.set(i,{date:new Date(o.getFullYear(),o.getMonth(),o.getDate()),pagesRead:0,timeRead:0,sessions:0});const v=e.get(i);v.pagesRead+=l.pagesRead||0,v.timeRead+=l.timeRead||0,v.sessions+=1}),e}),te=H(()=>{const e=new Date,l=new Date(e.getFullYear(),e.getMonth(),e.getDate()),o=new Date(l);o.setDate(o.getDate()-364);const i=l.getDay(),v=i===0?0:7-i;l.setDate(l.getDate()+v);const u=o.getDay();o.setDate(o.getDate()-u),o.setDate(o.getDate()+1);const p=[];let _=new Date(o);for(;_<=l;){const y=[];for(let M=0;M<7;M++){const P=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}-${String(_.getDate()).padStart(2,"0")}`,W=a(U).get(P);y.push({date:new Date(_),dayKey:P,pagesRead:W?.pagesRead||0,timeRead:W?.timeRead||0,sessions:W?.sessions||0}),_.setDate(_.getDate()+1)}p.push(y)}return p});function D(e){return e===0?"#ebedf0":e<10?"#9be9a8":e<25?"#40c463":e<50?"#30a14e":"#216e39"}function x(e){const l=e.date.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"});return e.pagesRead===0?`${l}
No reading activity`:`${l}
${e.pagesRead} pages
${Ce(e.timeRead)}
${e.sessions} session${e.sessions!==1?"s":""}`}function se(e,l){B(Z,x(l),!0),ae(e),B(m,!0)}function ae(e){B(ee,e.clientX,!0),B($,e.clientY,!0)}function oe(){B(m,!1)}let ge=H(()=>{const e=[];let l=-1;return a(te).forEach((o,i)=>{const v=o[0],u=v.date.getMonth();if(u!==l){if(i>0&&e.length===0){l=u;return}(e.length===0||i-e[e.length-1].weekIndex>=2)&&(e.push({weekIndex:i,month:v.date.toLocaleDateString("en-US",{month:"short"})}),l=u)}}),e}),X=H(()=>{let e=0,l=0,o=0,i=0,v=0;a(U).forEach(y=>{e+=y.pagesRead,l+=y.timeRead,y.pagesRead>0&&o++});const u=new Date;u.setHours(0,0,0,0);let p=new Date(u),_=!0;for(let y=0;y<365;y++){const M=`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}-${String(p.getDate()).padStart(2,"0")}`,P=a(U).get(M);P&&P.pagesRead>0?(v++,v>i&&(i=v)):(_&&(p.getTime()===u.getTime()||(_=!1)),_||(v=0)),p.setDate(p.getDate()-1)}return{totalPages:e,totalTime:l,activeDays:o,currentStreak:_?v:0,longestStreak:i}});var g=ct(),d=s(g),n=r(s(d),2),f=s(n),k=s(f),A=s(k,!0);t(k),S(2),t(f);var F=r(f,2),h=s(F),b=s(h,!0);t(h),S(2),t(F);var R=r(F,2),j=s(R),V=s(j,!0);t(j),S(2),t(R),t(n),t(d);var C=r(d,2),L=s(C);de(L,21,()=>a(ge),ne,(e,l)=>{var o=vt(),i=s(o,!0);t(o),N(()=>{De(o,`left: ${a(l).weekIndex*14}px;`),c(i,a(l).month)}),z(e,o)}),t(L);var q=r(L,2),le=r(s(q),2);de(le,21,()=>a(te),ne,(e,l)=>{var o=dt();de(o,21,()=>a(l),ne,(i,v)=>{var u=it();u.__mousemove=ae,N(p=>De(u,`background-color: ${p??""}`),[()=>D(a(v).pagesRead)]),Te("mouseenter",u,p=>se(p,a(v))),Te("mouseleave",u,oe),z(i,u)}),t(o),z(e,o)}),t(le),t(q),t(C);var G=r(C,2);{var re=e=>{var l=nt(),o=s(l,!0);t(l),N(()=>{De(l,`left: ${a(ee)??""}px; top: ${a($)??""}px;`),c(o,a(Z))}),z(e,l)};ce(G,e=>{a(m)&&e(re)})}S(2),t(g),N(()=>{c(A,a(X).activeDays),c(b,a(X).currentStreak),c(V,a(X).longestStreak)}),z(ue,g),Ae()}Me(["mousemove"]);var gt=T('<span class="book-info svelte-1ke34sz"><span class="book-title svelte-1ke34sz"> </span> <span class="book-pages svelte-1ke34sz"> </span></span>'),ft=T('<tr class="svelte-1ke34sz"><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"><!></td></tr>'),kt=T('<div class="books-by-year svelte-1ke34sz"><h2 class="svelte-1ke34sz">Books by Year</h2> <table class="svelte-1ke34sz"><thead><tr class="svelte-1ke34sz"><th class="svelte-1ke34sz">Year</th><th class="svelte-1ke34sz">Books</th><th class="svelte-1ke34sz">Hours</th><th class="svelte-1ke34sz">Pages</th><th class="svelte-1ke34sz">Longest Book</th></tr></thead><tbody></tbody></table></div>'),pt=T('<!> <div class="profile-container svelte-1ke34sz"><div class="profile-header svelte-1ke34sz"><h1 class="svelte-1ke34sz"> </h1> <p class="email svelte-1ke34sz"> </p></div> <div class="actions svelte-1ke34sz"><button class="svelte-1ke34sz">Add New Book</button> <button class="svelte-1ke34sz">Sign Out</button></div> <div class="stats-grid svelte-1ke34sz"><a href="/finished" class="stat-card clickable svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Books Read</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">Completed books</div></a> <a href="/" class="stat-card clickable svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Currently Reading</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">In progress</div></a> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Total Time Read</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz"> </div></div> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Books Per Year</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">Average rate</div></div> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Avg. Time Per Book</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">For finished books</div></div> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Total Books</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">In your library</div></div></div> <!> <!></div>',1);function Dt(ue,w){Pe(w,!0);const m=()=>st(ot,"$user",Z),[Z,ee]=at();let $=O(!1);async function K(){await lt(),rt("/",{replaceState:!0})}const U=()=>B($,!a($)),te=()=>B($,!1);let D=O(Ye([]));$e(()=>{if(m())return Fe.getAllBooks(m().uid).subscribe(d=>{B(D,d,!0)})});const x=H(()=>()=>{const g=a(D).filter(h=>h.finished),d=a(D).filter(h=>!h.finished),n=a(D).reduce((h,b)=>h+(b.timeRead||0),0),f=a(D).reduce((h,b)=>h+(b.pagesRead||0),0);let k=0;if(g.length>0){const b=g.map(j=>j.createdAt?.toDate?.()||new Date).sort((j,V)=>j-V)[0],R=(new Date-b)/(1e3*60*60*24*365);k=R>0?(g.length/R).toFixed(1):0}const A=g.length>0?Math.round(g.reduce((h,b)=>h+(b.timeRead||0),0)/g.length):0,F=Math.round(n/60);return{totalBooks:a(D).length,finishedBooks:g.length,readingBooks:d.length,totalTimeRead:n,totalTimeReadHours:F,totalPagesRead:f,booksPerYear:k,avgTimePerBook:A}}),se=H(()=>()=>{const g=a(D).filter(n=>n.finished),d={};return g.forEach(n=>{const f=n.createdAt?.toDate?.();if(f){const k=f.getFullYear();d[k]||(d[k]={count:0,totalTimeRead:0,totalPages:0,longestBook:null}),d[k].count+=1,d[k].totalTimeRead+=n.timeRead||0,d[k].totalPages+=n.pagesRead||0,(!d[k].longestBook||n.pageCount>d[k].longestBook.pageCount)&&(d[k].longestBook=n)}}),Object.entries(d).sort(([n],[f])=>f-n).map(([n,f])=>({year:n,count:f.count,totalTimeRead:f.totalTimeRead,totalPages:f.totalPages,longestBook:f.longestBook}))}),ae=H(()=>m()?m().email.split("@")[0]:"");var oe=Ze(),ge=we(oe);{var X=g=>{var d=pt(),n=we(d);tt(n,{get open(){return a($)},onclose:te,get userId(){return m().uid}});var f=r(n,2),k=s(f),A=s(k),F=s(A);t(A);var h=r(A,2),b=s(h,!0);t(h),t(k);var R=r(k,2),j=s(R);j.__click=U;var V=r(j,2);V.__click=K,t(R);var C=r(R,2),L=s(C),q=r(s(L),2),le=s(q,!0);t(q),S(2),t(L);var G=r(L,2),re=r(s(G),2),e=s(re,!0);t(re),S(2),t(G);var l=r(G,2),o=r(s(l),2),i=s(o);t(o);var v=r(o,2),u=s(v);t(v),t(l);var p=r(l,2),_=r(s(p),2),y=s(_,!0);t(_),S(2),t(p);var M=r(p,2),P=r(s(M),2),W=s(P,!0);t(P),S(2),t(M);var Be=r(M,2),xe=r(s(Be),2),Le=s(xe,!0);t(xe),S(2),t(Be),t(C);var Re=r(C,2);{var Ee=J=>{var Q=kt(),ve=r(s(Q),2),ie=r(s(ve));de(ie,21,()=>a(se)(),ne,(fe,E)=>{let ke=()=>a(E).year,Oe=()=>a(E).count,He=()=>a(E).totalTimeRead,Ne=()=>a(E).totalPages,pe=()=>a(E).longestBook;var he=ft(),_e=s(he),We=s(_e,!0);t(_e);var me=r(_e),Ke=s(me,!0);t(me);var be=r(me),Ue=s(be,!0);t(be);var ye=r(be),Xe=s(ye,!0);t(ye);var je=r(ye),Ve=s(je);{var qe=Y=>{var I=gt(),ze=s(I),Je=s(ze,!0);t(ze);var Se=r(ze,2),Qe=s(Se);t(Se),t(I),N(()=>{c(Je,pe().title),c(Qe,`(${pe().pageCount??""} pages)`)}),z(Y,I)},Ge=Y=>{var I=et("-");z(Y,I)};ce(Ve,Y=>{pe()?Y(qe):Y(Ge,!1)})}t(je),t(he),N((Y,I)=>{c(We,ke()),c(Ke,Oe()),c(Ue,Y),c(Xe,I)},[()=>Math.round(He()/60),()=>Ne().toLocaleString()]),z(fe,he)}),t(ie),t(ve),t(Q),z(J,Q)};ce(Re,J=>{a(se)().length>0&&J(Ee)})}var Ie=r(Re,2);ut(Ie,{get userId(){return m().uid},get allBooks(){return a(D)}}),t(f),N((J,Q,ve,ie,fe,E,ke)=>{c(F,`Welcome back, ${a(ae)??""}!`),c(b,m().email),c(le,J),c(e,Q),c(i,`${ve??""} hrs`),c(u,`${ie??""} pages read`),c(y,fe),c(W,E),c(Le,ke)},[()=>a(x)().finishedBooks,()=>a(x)().readingBooks,()=>a(x)().totalTimeReadHours,()=>a(x)().totalPagesRead.toLocaleString(),()=>a(x)().booksPerYear,()=>Ce(a(x)().avgTimePerBook),()=>a(x)().totalBooks]),z(g,d)};ce(ge,g=>{m()&&g(X)})}z(ue,oe),Ae(),ee()}Me(["click"]);export{Dt as component};

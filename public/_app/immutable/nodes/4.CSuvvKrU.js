import{d as je,c as Ee,a as b,f as S,s as v,t as We}from"../chunks/B3brjmWg.js";import{p as $e,s as ie,g as qe,b as Ge,h as J,f as de,a as Je,m as a,j as s,i as t,k as e,A as R,n as K,t as Q}from"../chunks/COs9BhvN.js";import{D as Ke,N as Qe,f as Ue,e as Ve,i as Xe}from"../chunks/Bw3RGzCI.js";import{a as Ze,i as U,s as et}from"../chunks/4Dd6Wes_.js";import{u as tt,s as st}from"../chunks/BTWxJjmP.js";import{g as at}from"../chunks/BHoEDKpM.js";var ot=S('<span class="book-info svelte-1ke34sz"><span class="book-title svelte-1ke34sz"> </span> <span class="book-pages svelte-1ke34sz"> </span></span>'),lt=S('<tr class="svelte-1ke34sz"><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"> </td><td class="svelte-1ke34sz"><!></td></tr>'),rt=S('<div class="books-by-year svelte-1ke34sz"><h2 class="svelte-1ke34sz">Books by Year</h2> <table class="svelte-1ke34sz"><thead><tr class="svelte-1ke34sz"><th class="svelte-1ke34sz">Year</th><th class="svelte-1ke34sz">Books</th><th class="svelte-1ke34sz">Hours</th><th class="svelte-1ke34sz">Pages</th><th class="svelte-1ke34sz">Longest Book</th></tr></thead><tbody></tbody></table></div>'),vt=S('<!> <div class="profile-container svelte-1ke34sz"><div class="profile-header svelte-1ke34sz"><h1 class="svelte-1ke34sz"> </h1> <p class="email svelte-1ke34sz"> </p></div> <div class="actions svelte-1ke34sz"><button class="svelte-1ke34sz">Add New Book</button> <button class="svelte-1ke34sz">Sign Out</button></div> <div class="stats-grid svelte-1ke34sz"><a href="/finished" class="stat-card clickable svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Books Read</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">Completed books</div></a> <a href="/" class="stat-card clickable svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Currently Reading</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">In progress</div></a> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Total Time Read</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz"> </div></div> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Books Per Year</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">Average rate</div></div> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Avg. Time Per Book</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">For finished books</div></div> <div class="stat-card svelte-1ke34sz"><div class="stat-label svelte-1ke34sz">Total Books</div> <div class="stat-value svelte-1ke34sz"> </div> <div class="stat-subtext svelte-1ke34sz">In your library</div></div></div> <!></div>',1);function gt(ce,ne){$e(ne,!0);const u=()=>Ze(tt,"$user",ke),[ke,ue]=et();let y=ie(!1);async function ge(){await st(),at("/",{replaceState:!0})}const _e=()=>J(y,!a(y)),fe=()=>J(y,!1);let g=ie(qe([]));Ge(()=>{if(u())return Ke.getAllBooks(u().uid).subscribe(l=>{J(g,l,!0)})});const _=K(()=>()=>{const i=a(g).filter(c=>c.finished),l=a(g).filter(c=>!c.finished),o=a(g).reduce((c,n)=>c+(n.timeRead||0),0),d=a(g).reduce((c,n)=>c+(n.pagesRead||0),0);let r=0;if(i.length>0){const n=i.map(p=>p.createdAt?.toDate?.()||new Date).sort((p,D)=>p-D)[0],h=(new Date-n)/(1e3*60*60*24*365);r=h>0?(i.length/h).toFixed(1):0}const m=i.length>0?Math.round(i.reduce((c,n)=>c+(n.timeRead||0),0)/i.length):0,A=Math.round(o/60);return{totalBooks:a(g).length,finishedBooks:i.length,readingBooks:l.length,totalTimeRead:o,totalTimeReadHours:A,totalPagesRead:d,booksPerYear:r,avgTimePerBook:m}}),V=K(()=>()=>{const i=a(g).filter(o=>o.finished),l={};return i.forEach(o=>{const d=o.createdAt?.toDate?.();if(d){const r=d.getFullYear();l[r]||(l[r]={count:0,totalTimeRead:0,totalPages:0,longestBook:null}),l[r].count+=1,l[r].totalTimeRead+=o.timeRead||0,l[r].totalPages+=o.pagesRead||0,(!l[r].longestBook||o.pageCount>l[r].longestBook.pageCount)&&(l[r].longestBook=o)}}),Object.entries(l).sort(([o],[d])=>d-o).map(([o,d])=>({year:o,count:d.count,totalTimeRead:d.totalTimeRead,totalPages:d.totalPages,longestBook:d.longestBook}))}),ze=K(()=>u()?u().email.split("@")[0]:"");var X=Ee(),he=de(X);{var pe=i=>{var l=vt(),o=de(l);Qe(o,{get open(){return a(y)},onclose:fe,get userId(){return u().uid}});var d=s(o,2),r=t(d),m=t(r),A=t(m);e(m);var c=s(m,2),n=t(c,!0);e(c),e(r);var h=s(r,2),p=t(h);p.__click=_e;var D=s(p,2);D.__click=ge,e(h);var M=s(h,2),Y=t(M),Z=s(t(Y),2),be=t(Z,!0);e(Z),R(2),e(Y);var w=s(Y,2),ee=s(t(w),2),me=t(ee,!0);e(ee),R(2),e(w);var C=s(w,2),F=s(t(C),2),Be=t(F);e(F);var te=s(F,2),xe=t(te);e(te),e(C);var O=s(C,2),se=s(t(O),2),Re=t(se,!0);e(se),R(2),e(O);var H=s(O,2),ae=s(t(H),2),ye=t(ae,!0);e(ae),R(2),e(H);var oe=s(H,2),le=s(t(oe),2),Te=t(le,!0);e(le),R(2),e(oe),e(M);var Pe=s(M,2);{var Se=B=>{var x=rt(),T=s(t(x),2),P=s(t(T));Ve(P,21,()=>a(V)(),Xe,(I,f)=>{let L=()=>a(f).year,Ae=()=>a(f).count,De=()=>a(f).totalTimeRead,Me=()=>a(f).totalPages,N=()=>a(f).longestBook;var j=lt(),E=t(j),Ye=t(E,!0);e(E);var W=s(E),we=t(W,!0);e(W);var $=s(W),Ce=t($,!0);e($);var q=s($),Fe=t(q,!0);e(q);var re=s(q),Oe=t(re);{var He=k=>{var z=ot(),G=t(z),Le=t(G,!0);e(G);var ve=s(G,2),Ne=t(ve);e(ve),e(z),Q(()=>{v(Le,N().title),v(Ne,`(${N().pageCount??""} pages)`)}),b(k,z)},Ie=k=>{var z=We("-");b(k,z)};U(Oe,k=>{N()?k(He):k(Ie,!1)})}e(re),e(j),Q((k,z)=>{v(Ye,L()),v(we,Ae()),v(Ce,k),v(Fe,z)},[()=>Math.round(De()/60),()=>Me().toLocaleString()]),b(I,j)}),e(P),e(T),e(x),b(B,x)};U(Pe,B=>{a(V)().length>0&&B(Se)})}e(d),Q((B,x,T,P,I,f,L)=>{v(A,`Welcome back, ${a(ze)??""}!`),v(n,u().email),v(be,B),v(me,x),v(Be,`${T??""} hrs`),v(xe,`${P??""} pages read`),v(Re,I),v(ye,f),v(Te,L)},[()=>a(_)().finishedBooks,()=>a(_)().readingBooks,()=>a(_)().totalTimeReadHours,()=>a(_)().totalPagesRead.toLocaleString(),()=>a(_)().booksPerYear,()=>Ue(a(_)().avgTimePerBook),()=>a(_)().totalBooks]),b(i,l)};U(he,i=>{u()&&i(pe)})}b(ce,X),Je(),ue()}je(["click"]);export{gt as component};

import{R as se,H as O,aj as qe,F as fe,M as Ne,L as Me,j as h,a1 as ze,O as He,P as Le,Q as be,T as re,I as J,ak as Oe,al as Fe,am as he,B as Ue,G as ve,K as Ve,an as Re,ao as Ae,ap as Ye,aq as Ee,ar as Te,V as $e,aa as ge,as as je,C as Se,E as Ke,at as ne,q as Ge,au as Qe,av as Xe,aw as Je,ax as We,ay as Ze,D as ea,w as z,v as M,x as H,A as Z,p as Ie,b as aa,f as pe,a as Pe,y as oe,az as ie,s as V,o as Y,t as $,z as de}from"./CmTovZ1L.js";import{f as q,t as ee,a as A,s as ae,d as ta,c as sa}from"./CQ5d6LE4.js";import{b as Be,f as ra,B as ke,q as le,o as we,w as na,h as F,i as ue,j as W,k as P,l as S,m as U,n as oa,p as ia,t as da,v as ye,x as k,r as j,c as K}from"./C1qYwYBx.js";import{p as L,i as Q}from"./CB2o9Wn4.js";function Ta(d,e){return e}function la(d,e,a){for(var n=[],l=e.length,o=0;o<l;o++)Je(e[o].e,n,!0);We(n,()=>{var s=n.length===0&&a!==null;if(s){var r=a,t=r.parentNode;Ze(t),t.append(r),d.items.clear(),B(d,e[0].prev,e[l-1].next)}for(var f=0;f<l;f++){var c=e[f];s||(d.items.delete(c.k),B(d,c.prev,c.next)),ea(c.e,!s)}d.first===e[0]&&(d.first=e[0].prev)})}function Sa(d,e,a,n,l,o=null){var s=d,r=new Map,t=null,f=(e&Re)!==0,c=(e&Ee)!==0,w=(e&Te)!==0;if(f){var _=d;s=O?se(qe(_)):_.appendChild(fe())}O&&Ne();var v=null,y=ze(()=>{var b=a();return Ye(b)?b:b==null?[]:Ae(b)}),x,u=!0;function p(){ua(E,x,s,e,n),v!==null&&(x.length===0?(v.fragment?(s.before(v.fragment),v.fragment=null):Se(v.effect),C.first=v.effect):Ke(v.effect,()=>{v=null}))}var C=Me(()=>{x=h(y);var b=x.length;let D=!1;if(O){var R=He(s)===Le;R!==(b===0)&&(s=be(),se(s),re(!1),D=!0)}for(var T=new Set,i=Ue,m=null,N=Ve(),g=0;g<b;g+=1){O&&J.nodeType===Oe&&J.data===Fe&&(s=J,D=!0,re(!1));var te=x[g],X=n(te,g),I=u?null:r.get(X);I?(c&&he(I.v,te),w?he(I.i,g):I.i=g,N&&i.skipped_effects.delete(I.e)):(I=ca(u?s:null,m,te,X,g,l,e,a),u&&(I.o=!0,m===null?t=I:m.next=I,m=I),r.set(X,I)),T.add(X)}if(b===0&&o&&!v)if(u)v={fragment:null,effect:ve(()=>o(s))};else{var _e=document.createDocumentFragment(),me=fe();_e.append(me),v={fragment:_e,effect:ve(()=>o(me))}}if(O&&b>0&&se(be()),!u)if(N){for(const[Ce,De]of r)T.has(Ce)||i.skipped_effects.add(De.e);i.oncommit(p),i.ondiscard(()=>{})}else p();D&&re(!0),h(y)}),E={effect:C,items:r,first:t};u=!1,O&&(s=J)}function ua(d,e,a,n,l){var o=(n&Qe)!==0,s=e.length,r=d.items,t=d.first,f,c=null,w,_=[],v=[],y,x,u,p;if(o)for(p=0;p<s;p+=1)y=e[p],x=l(y,p),u=r.get(x),u.o&&(u.a?.measure(),(w??=new Set).add(u));for(p=0;p<s;p+=1){if(y=e[p],x=l(y,p),u=r.get(x),d.first??=u,!u.o){u.o=!0;var C=c?c.next:t;B(d,c,u),B(d,u,C),ce(u,C,a),c=u,_=[],v=[],t=c.next;continue}if((u.e.f&ne)!==0&&(Se(u.e),o&&(u.a?.unfix(),(w??=new Set).delete(u))),u!==t){if(f!==void 0&&f.has(u)){if(_.length<v.length){var E=v[0],b;c=E.prev;var D=_[0],R=_[_.length-1];for(b=0;b<_.length;b+=1)ce(_[b],E,a);for(b=0;b<v.length;b+=1)f.delete(v[b]);B(d,D.prev,R.next),B(d,c,D),B(d,R,E),t=E,c=R,p-=1,_=[],v=[]}else f.delete(u),ce(u,t,a),B(d,u.prev,u.next),B(d,u,c===null?d.first:c.next),B(d,c,u),c=u;continue}for(_=[],v=[];t!==null&&t.k!==x;)(t.e.f&ne)===0&&(f??=new Set).add(t),v.push(t),t=t.next;if(t===null)continue;u=t}_.push(u),c=u,t=u.next}let T=r.size>s;if(t!==null||f!==void 0){for(var i=f===void 0?[]:Ae(f);t!==null;)(t.e.f&ne)===0&&i.push(t),t=t.next;var m=i.length;if(T=r.size-m>s,m>0){var N=(n&Re)!==0&&s===0?a:null;if(o){for(p=0;p<m;p+=1)i[p].a?.measure();for(p=0;p<m;p+=1)i[p].a?.fix()}la(d,i,N)}}if(T)for(const g of r.values())g.o||(B(d,c,g),c=g);d.effect.last=c&&c.e,o&&Ge(()=>{if(w!==void 0)for(u of w)u.a?.apply()})}function ca(d,e,a,n,l,o,s,r){var t=(s&Ee)!==0,f=(s&je)===0,c=t?f?$e(a,!1,!1):ge(a):a,w=(s&Te)===0?l:ge(l),_={i:w,v:c,k:n,a:null,e:null,o:!1,prev:e,next:null};try{if(d===null){var v=document.createDocumentFragment();v.append(d=fe())}return _.e=ve(()=>o(d,c,w,r)),e!==null&&(e.next=_),_}finally{}}function ce(d,e,a){for(var n=d.next?d.next.e.nodes_start:a,l=e?e.e.nodes_start:a,o=d.e.nodes_start;o!==null&&o!==n;){var s=Xe(o);l.before(o),o=s}}function B(d,e,a){e===null?(d.first=a,d.effect.first=a&&a.e):(e.e.next&&(e.e.next.prev=null),e.next=a,e.e.next=a&&a.e),a!==null&&(a.e.prev&&(a.e.prev.next=null),a.prev=e,a.e.prev=e&&e.e)}var fa=q("<label> </label>"),va=q('<div class="column svelte-8ff5h4"><!> <!></div>');function G(d,e){let a=L(e,"inputId",3,void 0);var n=va(),l=z(n);{var o=r=>{var t=fa(),f=z(t,!0);H(t),Z(()=>{ra(t,"for",a()),ae(f,e.label)}),A(r,t)};Q(l,r=>{e.label&&r(o)})}var s=M(l,2);Be(s,e,"default",{},r=>{var t=ee("Yeet");A(r,t)}),H(n),A(d,n)}var pa=q('<h4 class="header"> </h4> <div class="divider svelte-1qzjm47"></div>',1),_a=q('<div role="presentation" class="background svelte-1qzjm47"><div class="card hover svelte-1qzjm47"><!> <div class="content svelte-1qzjm47"><!></div> <div class="divider svelte-1qzjm47"></div> <div class="buttons svelte-1qzjm47"><!> <!></div></div></div>');function ma(d,e){Ie(e,!0);let a=L(e,"header",3,void 0),n=L(e,"primaryAction",3,void 0),l=L(e,"primaryText",3,"Do it!"),o=L(e,"secondaryText",3,"Close"),s=L(e,"hideSecondary",3,!1);aa(()=>(window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)));const r=()=>e.onclose();function t(_){n()&&_.key==="Enter"?n()():_.key==="Escape"&&r()}var f=sa(),c=pe(f);{var w=_=>{var v=_a();v.__click=r,v.__keydown=i=>i.key==="Escape"&&r();var y=z(v);y.__click=i=>i.stopPropagation(),y.__keydown=i=>i.stopPropagation();var x=z(y);{var u=i=>{var m=pa(),N=pe(m),g=z(N,!0);H(N),oe(2),Z(()=>ae(g,a())),A(i,m)};Q(x,i=>{a()&&i(u)})}var p=M(x,2),C=z(p);Be(C,e,"default",{},i=>{var m=ee("No content");A(i,m)}),H(p);var E=M(p,4),b=z(E);{var D=i=>{ke(i,{onclick:r,children:(m,N)=>{oe();var g=ee();Z(()=>ae(g,o())),A(m,g)},$$slots:{default:!0}})};Q(b,i=>{s()||i(D)})}var R=M(b,2);{var T=i=>{ke(i,{primary:!0,get onclick(){return n()},children:(m,N)=>{oe();var g=ee();Z(()=>ae(g,l())),A(m,g)},$$slots:{default:!0}})};Q(R,i=>{n()&&i(T)})}H(E),H(y),H(v),A(_,v)};Q(c,_=>{e.open&&_(w)})}A(d,f),Pe()}ta(["click","keydown"]);class xe{static getBooks(e,a){const n=ie([]),l=le(F(k,"users",e,"books"),na("finished","==",a),we("updatedAt","desc")),o=ue(l,s=>{const r=[];s.forEach(t=>{r.push({id:t.id,...t.data()})}),n.set(r)});return{subscribe:n.subscribe,unsubscribe:o}}static getAllBooks(e){const a=ie([]),n=le(F(k,"users",e,"books"),we("createdAt","desc")),l=ue(n,o=>{const s=[];o.forEach(r=>{s.push({id:r.id,...r.data()})}),a.set(s)});return{subscribe:a.subscribe,unsubscribe:l}}static async addPageUpdate({userId:e,id:a,currentPage:n,previousPage:l}){const o=W(k),s=P(k,"users",e,"books",a),r=P(F(k,"users",e,"books",a,"updates"));o.set(r,{book:s,type:"update",fromPage:l,toPage:n,pagesRead:n-l,updatedAt:S(),createdAt:S()}),o.update(s,{currentPage:n,updatedAt:S()}),await o.commit()}static async addReading({userId:e,id:a,previousPage:n,currentPage:l,timeRead:o}){const s=W(k),r=P(k,"users",e,"books",a),t=P(F(k,"users",e,"books",a,"updates")),f=l-n;s.set(t,{book:r,type:"reading",timeRead:o,fromPage:n,toPage:l,pagesRead:f,updatedAt:S(),createdAt:S()}),s.update(r,{currentPage:l,pagesRead:U(f),timeRead:U(o),updatedAt:S()}),await s.commit()}static async addBook({userId:e,author:a,title:n,pageCount:l,currentPage:o,isbn:s}){const r=P(k,"users",e);await oa(F(k,"users",e,"books"),{author:a,currentPage:o,finished:!1,owner:r,pageCount:l,pagesRead:0,timeRead:0,title:n,isbn:s,updatedAt:S(),createdAt:S()})}static async updateBook({userId:e,bookId:a,author:n,title:l,pageCount:o,isbn:s}){const r=P(k,"users",e,"books",a);await ia(r,{author:n,title:l,pageCount:o,isbn:s,updatedAt:S()})}static async deleteBook(e,a){const n=P(k,"users",e,"books",a);await da(n)}static async updateReadingSession({userId:e,bookId:a,sessionId:n,timeRead:l,fromPage:o,toPage:s}){const r=W(k),t=P(k,"users",e,"books",a,"updates",n),f=P(k,"users",e,"books",a),c=await ye(t);if(!c.exists())throw new Error("Session not found");const w=c.data(),_=w.timeRead||0,v=w.toPage-w.fromPage,y=s-o,x=l-_,u=y-v;r.update(t,{timeRead:l,fromPage:o,toPage:s,pagesRead:y,updatedAt:S()}),r.update(f,{currentPage:s,pagesRead:U(u),timeRead:U(x),updatedAt:S()}),await r.commit()}static async deleteReadingSession(e,a,n){const l=W(k),o=P(k,"users",e,"books",a,"updates",n),s=P(k,"users",e,"books",a),r=await ye(o);if(!r.exists())throw new Error("Session not found");const t=r.data(),f=t.timeRead||0,c=t.toPage-t.fromPage;l.delete(o),l.update(s,{currentPage:t.fromPage,pagesRead:U(-c),timeRead:U(-f),updatedAt:S()}),await l.commit()}static getReadingSessions(e,a){const n=ie([]),l=le(F(k,"users",e,"books",a,"updates")),o=ue(l,s=>{const r=[];s.forEach(t=>{const f=t.data();f.type==="reading"&&r.push({id:t.id,...f})}),r.sort((t,f)=>{const c=t.createdAt?.toMillis?.()||0;return(f.createdAt?.toMillis?.()||0)-c}),n.set(r)});return{subscribe:n.subscribe,unsubscribe:o}}}var ba=q('<input id="author" class="form-control" type="text" placeholder="Name of author(s)"/>'),ha=q('<input id="title" class="form-control" type="text" placeholder="Book title"/>'),ga=q('<input id="pageCount" class="form-control" type="number" placeholder="How many pages are there?"/>'),ka=q('<input id="currentPage" class="form-control" type="number" placeholder="Have you already started reading?"/>'),wa=q('<input id="isbn" class="form-control" type="text" placeholder="ISBN"/>'),ya=q('<!> <div class="space svelte-p2qnds"></div> <!> <div class="space svelte-p2qnds"></div> <!> <div class="space svelte-p2qnds"></div> <!> <div class="space svelte-p2qnds"></div> <!>',1);function Ia(d,e){Ie(e,!0);let a=L(e,"book",3,null),n=V(Y(a()?a().author:"")),l=V(Y(a()?a().title:"")),o=V(Y(a()?a().pageCount:void 0)),s=V(Y(a()?a().currentPage:1)),r=V(Y(a()?a().isbn:"")),t=de(()=>!!a());function f(){xe.addBook({userId:e.userId,author:h(n),title:h(l),pageCount:h(o),currentPage:h(s),isbn:h(r)}),e.onclose()}function c(){xe.updateBook({userId:e.userId,bookId:a().id,author:h(n),title:h(l),pageCount:h(o),isbn:h(r)}),e.onclose()}function w(){h(t)?c():f()}{let _=de(()=>h(t)?"Edit book":"Add new book"),v=de(()=>h(t)?"Update book":"Add book");ma(d,{get open(){return e.open},onclose:()=>e.onclose(),get header(){return h(_)},get primaryText(){return h(v)},primaryAction:w,children:(y,x)=>{var u=ya(),p=pe(u);G(p,{label:"Author",inputId:"author",children:(R,T)=>{var i=ba();j(i),K(i,()=>h(n),m=>$(n,m)),A(R,i)},$$slots:{default:!0}});var C=M(p,4);G(C,{label:"Book title",inputId:"title",children:(R,T)=>{var i=ha();j(i),K(i,()=>h(l),m=>$(l,m)),A(R,i)},$$slots:{default:!0}});var E=M(C,4);G(E,{label:"Number of pages",inputId:"pageCount",children:(R,T)=>{var i=ga();j(i),K(i,()=>h(o),m=>$(o,m)),A(R,i)},$$slots:{default:!0}});var b=M(E,4);G(b,{label:"Current page",inputId:"currentPage",children:(R,T)=>{var i=ka();j(i),K(i,()=>h(s),m=>$(s,m)),A(R,i)},$$slots:{default:!0}});var D=M(b,4);G(D,{label:"ISBN number (optional)",inputId:"isbn",children:(R,T)=>{var i=wa();j(i),K(i,()=>h(r),m=>$(r,m)),A(R,i)},$$slots:{default:!0}}),A(y,u)},$$slots:{default:!0}})}Pe()}function Pa(d){return`${String(Math.floor(d/60)).padStart(2,"0")}:${String(d%60).padStart(2,"0")}`}export{xe as D,G as I,ma as M,Ia as N,Sa as e,Pa as f,Ta as i};

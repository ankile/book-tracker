import{R as se,H as F,aj as Ne,F as ve,M as Me,L as ze,m as k,a1 as He,O as Le,P as Oe,Q as he,T as re,I as Z,ak as Fe,al as Ue,am as ke,B as Ve,G as pe,K as Ye,an as xe,ao as Ae,ap as je,aq as Ee,ar as Te,V as Ke,aa as ge,as as Ge,C as Se,E as Qe,at as ne,q as Xe,au as Je,av as We,aw as Ze,ax as $e,ay as ea,D as aa,i as H,j as z,k as L,t as ee,p as Ie,b as ta,f as _e,a as De,A as oe,az as ie,s as j,g as K,h as G,n as de}from"./COs9BhvN.js";import{f as q,t as ae,a as A,s as te,d as Pe,c as sa}from"./B3brjmWg.js";import{p as O,i as Y}from"./4Dd6Wes_.js";import{d as Be,h as ra,B as we,q as le,o as ye,w as na,j as U,k as ce,l as $,m as P,n as S,p as V,t as oa,v as ia,x as da,y as Re,z as g,r as Q,e as X}from"./BDqwyajx.js";function Sa(i,e){return e}function la(i,e,a){for(var n=[],d=e.length,o=0;o<d;o++)Ze(e[o].e,n,!0);$e(n,()=>{var s=n.length===0&&a!==null;if(s){var r=a,t=r.parentNode;ea(t),t.append(r),i.items.clear(),B(i,e[0].prev,e[d-1].next)}for(var f=0;f<d;f++){var u=e[f];s||(i.items.delete(u.k),B(i,u.prev,u.next)),aa(u.e,!s)}i.first===e[0]&&(i.first=e[0].prev)})}function Ia(i,e,a,n,d,o=null){var s=i,r=new Map,t=null,f=(e&xe)!==0,u=(e&Ee)!==0,w=(e&Te)!==0;if(f){var b=i;s=F?se(Ne(b)):b.appendChild(ve())}F&&Me();var v=null,R=He(()=>{var h=a();return je(h)?h:h==null?[]:Ae(h)}),y,l=!0;function m(){ca(T,y,s,e,n),v!==null&&(y.length===0?(v.fragment?(s.before(v.fragment),v.fragment=null):Se(v.effect),C.first=v.effect):Qe(v.effect,()=>{v=null}))}var C=ze(()=>{y=k(R);var h=y.length;let I=!1;if(F){var N=Le(s)===Oe;N!==(h===0)&&(s=he(),se(s),re(!1),I=!0)}for(var M=new Set,p=Ve,_=null,x=Ye(),c=0;c<h;c+=1){F&&Z.nodeType===Fe&&Z.data===Ue&&(s=Z,I=!0,re(!1));var E=y[c],W=n(E,c),D=l?null:r.get(W);D?(u&&ke(D.v,E),w?ke(D.i,c):D.i=c,x&&p.skipped_effects.delete(D.e)):(D=ua(l?s:null,_,E,W,c,d,e,a),l&&(D.o=!0,_===null?t=D:_.next=D,_=D),r.set(W,D)),M.add(W)}if(h===0&&o&&!v)if(l)v={fragment:null,effect:pe(()=>o(s))};else{var me=document.createDocumentFragment(),be=ve();me.append(be),v={fragment:me,effect:pe(()=>o(be))}}if(F&&h>0&&se(he()),!l)if(x){for(const[qe,Ce]of r)M.has(qe)||p.skipped_effects.add(Ce.e);p.oncommit(m),p.ondiscard(()=>{})}else m();I&&re(!0),k(R)}),T={effect:C,items:r,first:t};l=!1,F&&(s=Z)}function ca(i,e,a,n,d){var o=(n&Je)!==0,s=e.length,r=i.items,t=i.first,f,u=null,w,b=[],v=[],R,y,l,m;if(o)for(m=0;m<s;m+=1)R=e[m],y=d(R,m),l=r.get(y),l.o&&(l.a?.measure(),(w??=new Set).add(l));for(m=0;m<s;m+=1){if(R=e[m],y=d(R,m),l=r.get(y),i.first??=l,!l.o){l.o=!0;var C=u?u.next:t;B(i,u,l),B(i,l,C),ue(l,C,a),u=l,b=[],v=[],t=u.next;continue}if((l.e.f&ne)!==0&&(Se(l.e),o&&(l.a?.unfix(),(w??=new Set).delete(l))),l!==t){if(f!==void 0&&f.has(l)){if(b.length<v.length){var T=v[0],h;u=T.prev;var I=b[0],N=b[b.length-1];for(h=0;h<b.length;h+=1)ue(b[h],T,a);for(h=0;h<v.length;h+=1)f.delete(v[h]);B(i,I.prev,N.next),B(i,u,I),B(i,N,T),t=T,u=N,m-=1,b=[],v=[]}else f.delete(l),ue(l,t,a),B(i,l.prev,l.next),B(i,l,u===null?i.first:u.next),B(i,u,l),u=l;continue}for(b=[],v=[];t!==null&&t.k!==y;)(t.e.f&ne)===0&&(f??=new Set).add(t),v.push(t),t=t.next;if(t===null)continue;l=t}b.push(l),u=l,t=l.next}let M=r.size>s;if(t!==null||f!==void 0){for(var p=f===void 0?[]:Ae(f);t!==null;)(t.e.f&ne)===0&&p.push(t),t=t.next;var _=p.length;if(M=r.size-_>s,_>0){var x=(n&xe)!==0&&s===0?a:null;if(o){for(m=0;m<_;m+=1)p[m].a?.measure();for(m=0;m<_;m+=1)p[m].a?.fix()}la(i,p,x)}}if(M)for(const c of r.values())c.o||(B(i,u,c),u=c);i.effect.last=u&&u.e,o&&Xe(()=>{if(w!==void 0)for(l of w)l.a?.apply()})}function ua(i,e,a,n,d,o,s,r){var t=(s&Ee)!==0,f=(s&Ge)===0,u=t?f?Ke(a,!1,!1):ge(a):a,w=(s&Te)===0?d:ge(d),b={i:w,v:u,k:n,a:null,e:null,o:!1,prev:e,next:null};try{if(i===null){var v=document.createDocumentFragment();v.append(i=ve())}return b.e=pe(()=>o(i,u,w,r)),e!==null&&(e.next=b),b}finally{}}function ue(i,e,a){for(var n=i.next?i.next.e.nodes_start:a,d=e?e.e.nodes_start:a,o=i.e.nodes_start;o!==null&&o!==n;){var s=We(o);d.before(o),o=s}}function B(i,e,a){e===null?(i.first=a,i.effect.first=a&&a.e):(e.e.next&&(e.e.next.prev=null),e.next=a,e.e.next=a&&a.e),a!==null&&(a.e.prev&&(a.e.prev.next=null),a.prev=e,a.e.prev=e&&e.e)}var fa=q("<label> </label>"),va=q('<div class="column svelte-8ff5h4"><!> <!></div>');function J(i,e){let a=O(e,"inputId",3,void 0);var n=va(),d=H(n);{var o=r=>{var t=fa(),f=H(t,!0);L(t),ee(()=>{ra(t,"for",a()),te(f,e.label)}),A(r,t)};Y(d,r=>{e.label&&r(o)})}var s=z(d,2);Be(s,e,"default",{},r=>{var t=ae("Yeet");A(r,t)}),L(n),A(i,n)}var pa=q('<h4 class="header"> </h4> <div class="divider svelte-1qzjm47"></div>',1),_a=q('<div role="presentation" class="background svelte-1qzjm47"><div class="card hover svelte-1qzjm47"><!> <div class="content svelte-1qzjm47"><!></div> <div class="divider svelte-1qzjm47"></div> <div class="buttons svelte-1qzjm47"><!> <!></div></div></div>');function ma(i,e){Ie(e,!0);let a=O(e,"header",3,void 0),n=O(e,"primaryAction",3,void 0),d=O(e,"primaryText",3,"Do it!"),o=O(e,"secondaryText",3,"Close"),s=O(e,"hideSecondary",3,!1);ta(()=>(window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)));const r=()=>e.onclose();function t(b){n()&&b.key==="Enter"?n()():b.key==="Escape"&&r()}var f=sa(),u=_e(f);{var w=b=>{var v=_a();v.__click=r,v.__keydown=p=>p.key==="Escape"&&r();var R=H(v);R.__click=p=>p.stopPropagation(),R.__keydown=p=>p.stopPropagation();var y=H(R);{var l=p=>{var _=pa(),x=_e(_),c=H(x,!0);L(x),oe(2),ee(()=>te(c,a())),A(p,_)};Y(y,p=>{a()&&p(l)})}var m=z(y,2),C=H(m);Be(C,e,"default",{},p=>{var _=ae("No content");A(p,_)}),L(m);var T=z(m,4),h=H(T);{var I=p=>{we(p,{onclick:r,children:(_,x)=>{oe();var c=ae();ee(()=>te(c,o())),A(_,c)},$$slots:{default:!0}})};Y(h,p=>{s()||p(I)})}var N=z(h,2);{var M=p=>{we(p,{primary:!0,get onclick(){return n()},children:(_,x)=>{oe();var c=ae();ee(()=>te(c,d())),A(_,c)},$$slots:{default:!0}})};Y(N,p=>{n()&&p(M)})}L(T),L(R),L(v),A(b,v)};Y(u,b=>{e.open&&b(w)})}A(i,f),De()}Pe(["click","keydown"]);class fe{static getBooks(e,a){const n=ie([]),d=le(U(g,"users",e,"books"),na("finished","==",a),ye("updatedAt","desc")),o=ce(d,s=>{const r=[];s.forEach(t=>{r.push({id:t.id,...t.data()})}),n.set(r)});return{subscribe:n.subscribe,unsubscribe:o}}static getAllBooks(e){const a=ie([]),n=le(U(g,"users",e,"books"),ye("createdAt","desc")),d=ce(n,o=>{const s=[];o.forEach(r=>{s.push({id:r.id,...r.data()})}),a.set(s)});return{subscribe:a.subscribe,unsubscribe:d}}static async addPageUpdate({userId:e,id:a,currentPage:n,previousPage:d}){const o=$(g),s=P(g,"users",e,"books",a),r=P(U(g,"users",e,"books",a,"updates"));o.set(r,{book:s,type:"update",fromPage:d,toPage:n,pagesRead:n-d,updatedAt:S(),createdAt:S()}),o.update(s,{currentPage:n,updatedAt:S()}),await o.commit()}static async addReading({userId:e,id:a,previousPage:n,currentPage:d,timeRead:o}){const s=$(g),r=P(g,"users",e,"books",a),t=P(U(g,"users",e,"books",a,"updates")),f=d-n;s.set(t,{book:r,type:"reading",timeRead:o,fromPage:n,toPage:d,pagesRead:f,updatedAt:S(),createdAt:S()}),s.update(r,{currentPage:d,pagesRead:V(f),timeRead:V(o),updatedAt:S()}),await s.commit()}static async addBook({userId:e,author:a,title:n,pageCount:d,currentPage:o,isbn:s}){const r=P(g,"users",e);await oa(U(g,"users",e,"books"),{author:a,currentPage:o,finished:!1,owner:r,pageCount:d,pagesRead:0,timeRead:0,title:n,isbn:s,updatedAt:S(),createdAt:S()})}static async updateBook({userId:e,bookId:a,author:n,title:d,pageCount:o,isbn:s}){const r=P(g,"users",e,"books",a);await ia(r,{author:n,title:d,pageCount:o,isbn:s,updatedAt:S()})}static async deleteBook(e,a){const n=P(g,"users",e,"books",a);await da(n)}static async updateReadingSession({userId:e,bookId:a,sessionId:n,timeRead:d,fromPage:o,toPage:s}){const r=$(g),t=P(g,"users",e,"books",a,"updates",n),f=P(g,"users",e,"books",a),u=await Re(t);if(!u.exists())throw new Error("Session not found");const w=u.data(),b=w.timeRead||0,v=w.toPage-w.fromPage,R=s-o,y=d-b,l=R-v;r.update(t,{timeRead:d,fromPage:o,toPage:s,pagesRead:R,updatedAt:S()}),r.update(f,{currentPage:s,pagesRead:V(l),timeRead:V(y),updatedAt:S()}),await r.commit()}static async deleteReadingSession(e,a,n){const d=$(g),o=P(g,"users",e,"books",a,"updates",n),s=P(g,"users",e,"books",a),r=await Re(o);if(!r.exists())throw new Error("Session not found");const t=r.data(),f=t.timeRead||0,u=t.toPage-t.fromPage;d.delete(o),d.update(s,{currentPage:t.fromPage,pagesRead:V(-u),timeRead:V(-f),updatedAt:S()}),await d.commit()}static getReadingSessions(e,a){const n=ie([]),d=le(U(g,"users",e,"books",a,"updates")),o=ce(d,s=>{const r=[];s.forEach(t=>{const f=t.data();f.type==="reading"&&r.push({id:t.id,...f})}),r.sort((t,f)=>{const u=t.createdAt?.toMillis?.()||0;return(f.createdAt?.toMillis?.()||0)-u}),n.set(r)});return{subscribe:n.subscribe,unsubscribe:o}}}var ba=q('<input id="author" class="form-control" type="text" placeholder="Name of author(s)"/>'),ha=q('<input id="title" class="form-control" type="text" placeholder="Book title"/>'),ka=q('<input id="pageCount" class="form-control" type="number" placeholder="How many pages are there?"/>'),ga=q('<input id="currentPage" class="form-control" type="number" placeholder="Have you already started reading?"/>'),wa=q('<input id="isbn" class="form-control" type="text" placeholder="ISBN"/>'),ya=q('<button class="delete-button svelte-p2qnds">Delete this book</button>'),Ra=q('<!> <div class="space svelte-p2qnds"></div> <!> <div class="space svelte-p2qnds"></div> <!> <div class="space svelte-p2qnds"></div> <!> <div class="space svelte-p2qnds"></div> <!> <!>',1);function Da(i,e){Ie(e,!0);let a=O(e,"book",3,null),n=j(K(a()?a().author:"")),d=j(K(a()?a().title:"")),o=j(K(a()?a().pageCount:void 0)),s=j(K(a()?a().currentPage:1)),r=j(K(a()?a().isbn:"")),t=de(()=>!!a());function f(){fe.addBook({userId:e.userId,author:k(n),title:k(d),pageCount:k(o),currentPage:k(s),isbn:k(r)}),e.onclose()}function u(){fe.updateBook({userId:e.userId,bookId:a().id,author:k(n),title:k(d),pageCount:k(o),isbn:k(r)}),e.onclose()}function w(){k(t)?u():f()}function b(){confirm(`Are you sure you want to delete "${a().title}"? This will delete all reading sessions for this book.`)&&(fe.deleteBook(e.userId,a().id),e.onclose())}{let v=de(()=>k(t)?"Edit book":"Add new book"),R=de(()=>k(t)?"Update book":"Add book");ma(i,{get open(){return e.open},onclose:()=>e.onclose(),get header(){return k(v)},get primaryText(){return k(R)},primaryAction:w,children:(y,l)=>{var m=Ra(),C=_e(m);J(C,{label:"Author",inputId:"author",children:(_,x)=>{var c=ba();Q(c),X(c,()=>k(n),E=>G(n,E)),A(_,c)},$$slots:{default:!0}});var T=z(C,4);J(T,{label:"Book title",inputId:"title",children:(_,x)=>{var c=ha();Q(c),X(c,()=>k(d),E=>G(d,E)),A(_,c)},$$slots:{default:!0}});var h=z(T,4);J(h,{label:"Number of pages",inputId:"pageCount",children:(_,x)=>{var c=ka();Q(c),X(c,()=>k(o),E=>G(o,E)),A(_,c)},$$slots:{default:!0}});var I=z(h,4);J(I,{label:"Current page",inputId:"currentPage",children:(_,x)=>{var c=ga();Q(c),X(c,()=>k(s),E=>G(s,E)),A(_,c)},$$slots:{default:!0}});var N=z(I,4);J(N,{label:"ISBN number (optional)",inputId:"isbn",children:(_,x)=>{var c=wa();Q(c),X(c,()=>k(r),E=>G(r,E)),A(_,c)},$$slots:{default:!0}});var M=z(N,2);{var p=_=>{var x=ya();x.__click=b,A(_,x)};Y(M,_=>{k(t)&&_(p)})}A(y,m)},$$slots:{default:!0}})}De()}Pe(["click"]);function Pa(i){return`${String(Math.floor(i/60)).padStart(2,"0")}:${String(i%60).padStart(2,"0")}`}export{fe as D,J as I,ma as M,Da as N,Ia as e,Pa as f,Sa as i};
